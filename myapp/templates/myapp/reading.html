<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IELTS Reading Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">

  <!-- Header -->
  <header class="bg-white shadow-md fixed w-full top-0 z-50">
    <div class="container mx-auto flex justify-between items-center py-4 px-6">
      <h1 class="text-2xl font-bold text-red-600">GlobEdu</h1>
      <a href="{% url 'tests' %}" class="bg-white text-red-600 px-4 py-2 rounded-lg hover:bg-gray-100">⬅ Back</a>
    </div>
  </header>

  <!-- Stopwatch -->
  <section class="container mx-auto mt-20 px-6 text-center">
    <h2 class="text-xl font-semibold text-gray-700 mb-2">⏱ IELTS Reading Timer</h2>
    <div id="timer" class="text-3xl font-bold text-red-600 mb-4">00:00</div>
    <button onclick="startTimer()" class="bg-green-600 text-white px-4 py-2 rounded-lg mr-2">Start</button>
    <button onclick="stopTimer()" class="bg-yellow-500 text-white px-4 py-2 rounded-lg mr-2">Stop</button>
    <button onclick="resetTimer()" class="bg-gray-600 text-white px-4 py-2 rounded-lg">Reset</button>
  </section>

  <!-- Reading Test -->
  <section class="container mx-auto py-16 px-6">
    <h2 class="text-3xl font-bold mb-6 text-center text-red-600">IELTS Reading Practice Test</h2>

    <!-- Passage -->
    <div class="bg-white shadow-md rounded-xl p-6 mb-8">
      <h3 class="text-xl font-semibold mb-4">Passage: The History of the Printing Press</h3>
      <p class="text-gray-700 mb-4">
        The invention of the printing press by Johannes Gutenberg in the 15th century revolutionised the spread 
        of knowledge. Prior to its development, books were copied by hand, making them expensive and rare. 
        Gutenberg’s movable type allowed for the mass production of books, reducing costs and making literature 
        accessible to a wider audience. This technological breakthrough not only encouraged literacy but also 
        paved the way for the scientific revolution and the spread of new ideas across Europe.
      </p>
      <p class="text-gray-700 mb-4">
        The impact of the printing press was profound. Religious texts, scientific works, and literature could 
        be distributed widely, weakening the monopoly of the elite over education and knowledge. The press also 
        played a crucial role in cultural movements, such as the Renaissance, as scholars and artists were able 
        to share their discoveries and creative works more freely than ever before.
      </p>
    </div>

    <!-- Dynamic Questions Form -->
    <form id="readingForm" class="bg-white shadow-md rounded-xl p-6">
      <h3 class="text-xl font-semibold mb-4">Questions</h3>
      <ol id="questionsList" class="list-decimal pl-6 space-y-6"></ol>

      <button type="button" onclick="checkAnswers()" class="mt-6 bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
        Submit Answers
      </button>
      <div id="result" class="mt-6 text-lg font-semibold text-center"></div>
    </form>
  </section>

  <script>
    // Stopwatch
    let timerInterval;
    let seconds = 0;

    function updateTimer() {
      let mins = Math.floor(seconds / 60);
      let secs = seconds % 60;
      document.getElementById("timer").innerText =
        (mins < 10 ? "0" : "") + mins + ":" + (secs < 10 ? "0" : "") + secs;
    }

    function startTimer() {
      if (!timerInterval) {
        timerInterval = setInterval(() => {
          seconds++;
          updateTimer();
        }, 1000);
      }
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function resetTimer() {
      stopTimer();
      seconds = 0;
      updateTimer();
    }

    // Questions pool
    const questionPool = [
      {
        type: "mcq",
        question: "Before the printing press, books were:",
        options: [
          { value: "a", text: "Cheap and widely available" },
          { value: "b", text: "Handwritten and expensive" },
          { value: "c", text: "Printed in large numbers" },
          { value: "d", text: "Easy to access" },
        ],
        answer: "b"
      },
      {
        type: "tf",
        question: "The printing press helped promote the scientific revolution.",
        options: ["true", "false", "notgiven"],
        answer: "true"
      },
      {
        type: "fill",
        question: "Gutenberg’s movable type made books more ______.",
        answer: "affordable"
      },
      {
        type: "mcq",
        question: "Which cultural movement benefited greatly from the printing press?",
        options: [
          { value: "a", text: "The Renaissance" },
          { value: "b", text: "The Industrial Revolution" },
          { value: "c", text: "The Cold War" },
          { value: "d", text: "World War I" }
        ],
        answer: "a"
      },
      {
        type: "short",
        question: "What kind of texts were widely distributed after the printing press was invented?",
        answer: ["religious", "scientific", "literature"]
      }
    ];

    // Shuffle array helper
    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    // Render dynamic questions
    const questionsList = document.getElementById("questionsList");
    const selectedQuestions = shuffleArray([...questionPool]).slice(0, 5); // pick 5 random

    selectedQuestions.forEach((q, idx) => {
      let li = document.createElement("li");
      if (q.type === "mcq") {
        li.innerHTML = `<p>${q.question}</p><div class="mt-2 space-y-2">
          ${shuffleArray(q.options).map(opt => `<label><input type="radio" name="q${idx}" value="${opt.value}"> ${opt.text}</label>`).join('<br>')}
        </div>`;
      } else if (q.type === "tf") {
        li.innerHTML = `<p>${q.question}</p><select name="q${idx}" class="border rounded-lg px-3 py-2 mt-2">
          <option value="">-- Select --</option>
          ${q.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
        </select>`;
      } else if (q.type === "fill" || q.type === "short") {
        li.innerHTML = `<p>${q.question}</p><input type="text" name="q${idx}" class="w-full border rounded-lg px-3 py-2 mt-2" placeholder="Your answer...">`;
      }
      questionsList.appendChild(li);
    });

    // Check answers dynamically
    function checkAnswers() {
      let score = 0;
      selectedQuestions.forEach((q, idx) => {
        const userAnswer = document.querySelector(`[name="q${idx}"]`)?.value?.trim().toLowerCase();
        if (!userAnswer) return;
        if (q.type === "mcq" || q.type === "tf" || q.type === "fill") {
          if (userAnswer === q.answer) score++;
        } else if (q.type === "short") {
          if (q.answer.some(ans => userAnswer.includes(ans))) score++;
        }
      });
      document.getElementById("result").innerHTML = `✅ You scored <span class="text-red-600">${score}/${selectedQuestions.length}</span>`;
    }
  </script>

</body>
</html>
